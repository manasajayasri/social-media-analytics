<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>X Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  </head>
  <body>
    <header class="hero">
      <div class="hero__glass">
        {% if user.avatar %}<img
          class="avatar"
          src="{{ user.avatar }}"
          alt="avatar"
        />{% endif %}
        <div class="hero__meta">
          <h1>
            {{ user.name }} <span class="muted">@{{ user.username }}</span>
          </h1>
          <div class="stats">
            <div class="stat">
              <span>{{ "{:,}".format(user.followers) }}</span
              ><label>Followers</label>
            </div>
            <div class="stat">
              <span>{{ "{:,}".format(user.following) }}</span
              ><label>Following</label>
            </div>
            <div class="stat">
              <span>{{ "{:,}".format(user.tweet_count) }}</span
              ><label>Tweets</label>
            </div>
            <div class="stat">
              <span>{{ "{:,}".format(user.listed_count) }}</span
              ><label>Listed</label>
            </div>
          </div>
          <p class="muted">{{ user.desc }}</p>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="grid">
        <div class="card">
          <h3>Top 10 Tweets by Likes</h3>
          <div id="bar" style="height: 420px"></div>
        </div>
        <div class="card">
          <h3>Likes Over Time</h3>
          <div id="line" style="height: 420px"></div>
        </div>
      </section>

      <section class="card">
        <h3>Recent Tweets (Top 50 by likes)</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tweet</th>
                <th>Date</th>
                <th>Likes</th>
                <th>RTs</th>
                <th>Replies</th>
                <th>Quotes</th>
              </tr>
            </thead>
            <tbody>
              {% for row in table %}
              <tr>
                <td>
                  <a
                    target="_blank"
                    href="https://x.com/{{ user.username }}/status/{{ row.id }}"
                    >{{ row.text }}</a
                  >
                </td>
                <td>{{ row.created_at }}</td>
                <td>{{ "{:,}".format(row.likes) }}</td>
                <td>{{ "{:,}".format(row.retweets) }}</td>
                <td>{{ "{:,}".format(row.replies) }}</td>
                <td>{{ "{:,}".format(row.quotes) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <p class="muted small">
        <a href="{{ url_for('x_form') }}">‚Üê Try another username</a>
      </p>
    </main>

    <script>
      Plotly.newPlot('bar', [{
        type:'bar', x: {{ chart_values|tojson }}, y: {{ chart_labels|tojson }}, orientation:'h',
        hovertemplate:'%{y}<br>%{x:,} likes<extra></extra>'
      }], {margin:{l:200,r:20,t:10,b:40}}, {displayModeBar:false});

      Plotly.newPlot('line', [{
        type:'scatter', mode:'lines+markers',
        x: {{ chart2_dates|tojson }}, y: {{ chart2_values|tojson }},
        hovertemplate:'%{x}<br>%{y:,} likes<extra></extra>'
      }], {margin:{l:40,r:20,t:10,b:40}}, {displayModeBar:false});
    </script>
  </body>
</html>
